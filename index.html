<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body, html {
margin: 0;
padding: 0;
width: 100%;
height: 100%;
overflow: hidden;
}
canvas {
display: block;
width: 100%;
height: 100%;
}
#mainMenu {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: white;
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
}
#playButton {
padding: 10px 20px;
font-size: 24px;
border: none;
background-color: #4CAF50;
color: white;
cursor: pointer;
}
#score {
position: absolute;
bottom: 10px;
right: 10px;
font-size: 18px;
}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="mainMenu">
<h1>Roman.io</h1>
<input type="file" id="imageInput">
<button id="playButton">Играть</button>
</div>
<div id="score">Score: <span id="scoreValue">0</span></div>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const mainMenu = document.getElementById("mainMenu");
const playButton = document.getElementById("playButton");
const scoreElement = document.getElementById("scoreValue");
const imageInput = document.getElementById("imageInput");

let inMainMenu = true;
let score = 0;
let playerImage;
const ballImage = new Image();
ballImage.src = "nepivo.png"; // Путь к изображению для маленьких шариков

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const player = {
x: canvas.width / 2,
y: canvas.height / 2,
radius: 30,
};

const bot = {
x: Math.random() * canvas.width,
y: Math.random() * canvas.height,
radius: 30,
color: "red",
};

const smallBalls = [];

function createSmallBall() {
    const angle = Math.random() * Math.PI * 2;
    const distance = player.radius + 20;
    const x = player.x + Math.cos(angle) * distance;
    const y = player.y + Math.sin(angle) * distance;

    const ball = {
        x,
        y,
        radius: 10,
    };
    smallBalls.push(ball);
}

window.addEventListener("resize", () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});

canvas.addEventListener("mousemove", (e) => {
    if (!inMainMenu) {
        player.x = e.clientX;
        player.y = e.clientY;
    }
});

playButton.addEventListener("click", () => {
    console.log("Игра начинается!");
    mainMenu.style.display = "none";
    inMainMenu = false;
    
    // Проверяем, загружено ли изображение синего шара
    if (!playerImage) {
        // Если изображение не загружено, используем стандартный синий круг
        playerImage = new Image();
        playerImage.onload = () => {
            console.log("Изображение синего шара загружено!");
        };
        playerImage.src = "dadasereza.png"; // Путь к изображению для синего шара
    }
});

window.addEventListener("keydown", (e) => {
    if (e.key === "w" && player.radius > 10) {
        player.radius -= 5;
        createSmallBall();
    }
});

imageInput.addEventListener("change", (e) => {
    if (!inMainMenu) {
        const file = e.target.files[0];
        const reader = new FileReader();

        reader.onload = () => {
            playerImage = new Image();
            playerImage.src = reader.result;
        };

        reader.readAsDataURL(file);
    }
});

function moveBot() {
    const dx = player.x - bot.x;
    const dy = player.y - bot.y;
    const angle = Math.atan2(dy, dx);
    const speed = 1;
    bot.x += Math.cos(angle) * speed;
    bot.y += Math.sin(angle) * speed;
}

function resetGame() {
    player.radius = 30;
    player.x = canvas.width / 2;
    player.y = canvas.height / 2;
    bot.radius = 30;
    bot.x = Math.random() * canvas.width;
    bot.y = Math.random() * canvas.height;
    smallBalls.length = 0;
    inMainMenu = true;
    mainMenu.style.display = "flex";
    score = 0;
    updateScore();
}

function updateScore() {
    scoreElement.textContent = score;
    if (score >= 500) {
        alert("Победа!");
        resetGame();
    }
}

function animate() {
    if (!inMainMenu) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ctx.beginPath();
        ctx.strokeStyle = "lightgray";
        for (let x = 0; x < canvas.width; x += 50) {
            ctx.moveTo(x, 0);
            ctx.lineTo(x, canvas.height);
        }
        for (let y = 0; y < canvas.height; y += 50) {
            ctx.moveTo(0, y);
            ctx.lineTo(canvas.width, y);
        }
        ctx.stroke();

        moveBot();

        ctx.beginPath();
        ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
        if (playerImage) {
            ctx.drawImage(playerImage, player.x - player.radius, player.y - player.radius, player.radius * 2, player.radius * 2);
        } else {
            ctx.fillStyle = "blue";
            ctx.fill();
        }

        ctx.beginPath(); // Начать новый путь для отрисовки бота
        ctx.arc(bot.x, bot.y, bot.radius, 0, Math.PI * 2);
        ctx.fillStyle = bot.color;
        ctx.fill();

        smallBalls.forEach((ball) => {
            ctx.drawImage(ballImage, ball.x - ball.radius, ball.y - ball.radius, ball.radius * 2, ball.radius * 2);
        });

        smallBalls.forEach((ball, index) => {
            const dx = ball.x - player.x;
            const dy = ball.y - player.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance < player.radius + ball.radius) {
                player.radius += 2;
                smallBalls.splice(index, 1);
                createSmallBall();
                score += 1;
                updateScore();
            }
        });

        smallBalls.forEach((ball, index) => {
            const dx = ball.x - bot.x;
            const dy = ball.y - bot.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance < bot.radius + ball.radius) {
                bot.radius += 2;
                smallBalls.splice(index, 1);
                createSmallBall();
            }
        });

        const dx = player.x - bot.x;
        const dy = player.y - bot.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        if (distance < player.radius + bot.radius) {
            if (bot.radius > player.radius) {
                alert("Поражение!");
                resetGame();
            }
        }

        if (Math.random() < 0.01) {
            createSmallBall();
        }
    }

    requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>
